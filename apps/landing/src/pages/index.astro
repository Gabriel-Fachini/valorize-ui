---
import Layout from '../layouts/Layout.astro'
import Header from '../components/layout/Header.astro'
import Footer from '../components/layout/Footer.astro'
import Hero from '../components/sections/Hero.astro'
import Features from '../components/sections/Features.astro'
import HowItWorks from '../components/sections/HowItWorks.astro'
import Pricing from '../components/sections/Pricing.astro'
import FAQ from '../components/sections/FAQ.astro'
import CTA from '../components/sections/CTA.astro'
import "../styles/global.css"


const title = 'Valorize - Transforme a cultura da sua empresa'
const description = 'Plataforma completa de engajamento que conecta valores, reconhecimento e desenvolvimento profissional. Aumente a retenção e motivação dos seus colaboradores.'
---

<Layout title={title} description={description}>
  <!-- Skip Navigation Link -->
  <a 
    href="#main-content" 
    class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:px-4 focus:py-2 focus:bg-purple-600 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-purple-300"
  >
    Pular para o conteúdo principal
  </a>
  
  <Header />
  
  <main id="main-content">
    <Hero />
    <Features />
    <HowItWorks />
    <Pricing />
    <FAQ />
    <CTA />
  </main>
  
  <Footer />
</Layout>

<script>
  // Trial form modal functionality
  
  let trialModal: HTMLElement | null = null
  let previousFocusedElement: HTMLElement | null = null
  
  const createTrialModal = () => {
    // Remove existing modal if any
    if (trialModal) {
      trialModal.remove()
    }
    
    // Create modal HTML
    trialModal = document.createElement('div')
    trialModal.id = 'trial-modal'
    trialModal.className = 'fixed inset-0 z-50 hidden'
    
    trialModal.innerHTML = `
      <div class="fixed inset-0 bg-black/50 backdrop-blur-sm modal-backdrop" aria-hidden="true"></div>
      <div class="fixed inset-0 flex items-center justify-center p-4">
        <div 
          class="relative w-full max-w-lg bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 animate-fade-in modal-content"
          role="dialog"
          aria-labelledby="modal-title"
          aria-describedby="modal-description"
        >
          <button 
            class="absolute top-4 right-4 p-2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 rounded-lg modal-close"
            aria-label="Fechar modal"
          >
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          <div id="modal-form-container">
            <div class="text-center mb-6">
              <h3 id="modal-title" class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                Teste Gratuito - 14 Dias
              </h3>
              <p id="modal-description" class="text-gray-600 dark:text-gray-400">
                Descubra como o Valorize pode transformar a cultura da sua empresa
              </p>
            </div>

            <form id="trial-form" class="space-y-4">
              <div id="form-error" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                <p class="text-sm text-red-800 dark:text-red-400"></p>
              </div>

              <div>
                <label for="trial-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Email corporativo
                </label>
                <input
                  id="trial-email"
                  name="email"
                  type="email"
                  required
                  placeholder="seu@empresa.com"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
                />
                <p id="email-error" class="hidden mt-1 text-sm text-red-600 dark:text-red-400"></p>
              </div>

              <div class="flex flex-col sm:flex-row gap-3 pt-4">
                <button
                  type="submit"
                  id="submit-btn"
                  class="flex-1 inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-lg text-white bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span id="submit-text">Começar Teste Gratuito</span>
                  <svg id="loading-spinner" class="hidden animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </button>
                
                <button
                  type="button"
                  class="px-6 py-3 text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-offset-gray-800 modal-close"
                >
                  Cancelar
                </button>
              </div>
            </form>

            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
              <div class="flex items-center justify-center space-x-6 text-sm text-gray-500 dark:text-gray-400">
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Dados protegidos
                </div>
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Sem compromisso
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `
    
    document.body.appendChild(trialModal)
    
    // Add event listeners
    const backdrop = trialModal.querySelector('.modal-backdrop')
    const closeButtons = trialModal.querySelectorAll('.modal-close')
    const form = trialModal.querySelector('#trial-form') as HTMLFormElement
    
    const closeModal = () => {
      trialModal?.classList.add('hidden')
      document.body.style.overflow = 'unset'
      // Reset form
      form?.reset()
      hideErrors()
      
      // Restore focus to previously focused element
      if (previousFocusedElement) {
        previousFocusedElement.focus()
        previousFocusedElement = null
      }
    }
    
    const hideErrors = () => {
      const errorElements = trialModal?.querySelectorAll('[id$="-error"]')
      errorElements?.forEach(el => el.classList.add('hidden'))
    }
    
    const showError = (fieldId: string, message: string) => {
      const errorEl = trialModal?.querySelector(`#${fieldId}-error`)
      if (errorEl) {
        errorEl.textContent = message
        errorEl.classList.remove('hidden')
      }
    }
    
    const showFormError = (message: string) => {
      const errorEl = trialModal?.querySelector('#form-error')
      const errorText = errorEl?.querySelector('p')
      if (errorEl && errorText) {
        errorText.textContent = message
        errorEl.classList.remove('hidden')
      }
    }
    
    const showSuccess = () => {
      const container = trialModal?.querySelector('#modal-form-container')
      if (container) {
        container.innerHTML = `
          <div class="text-center py-8">
            <div class="w-16 h-16 mx-auto mb-4 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center">
              <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
              Sucesso!
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6">
              Recebemos sua solicitação. Nossa equipe entrará em contato em breve!
            </p>
            <button class="w-full px-6 py-3 text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-offset-gray-800 modal-close">
              Fechar
            </button>
          </div>
        `
        
        // Re-add close listener to new button
        const newCloseBtn = container.querySelector('.modal-close')
        newCloseBtn?.addEventListener('click', closeModal)
        
        // Auto close after 3 seconds
        setTimeout(closeModal, 3000)
      }
    }
    
    backdrop?.addEventListener('click', closeModal)
    closeButtons?.forEach(btn => btn.addEventListener('click', closeModal))
    
    // Form submission
    form?.addEventListener('submit', async (e) => {
      e.preventDefault()
      
      hideErrors()
      
      const formData = new FormData(form)
      const name = formData.get('name') as string
      const email = formData.get('email') as string
      
      // Basic validation
      let hasErrors = false
      
      if (!name || name.trim().length < 2) {
        showError('name', 'Nome deve ter pelo menos 2 caracteres')
        hasErrors = true
      }
      
      if (!email || !email.includes('@')) {
        showError('email', 'Digite um email válido')
        hasErrors = true
      }
      
      if (hasErrors) return
      
      // Show loading
      const submitBtn = form.querySelector('#submit-btn') as HTMLButtonElement
      const submitText = form.querySelector('#submit-text')
      const loadingSpinner = form.querySelector('#loading-spinner')
      
      submitBtn.disabled = true
      submitText!.textContent = 'Enviando...'
      loadingSpinner?.classList.remove('hidden')
      
      try {
        const response = await fetch('https://api.valorize.com/trial-requests', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: name.trim(),
            email: email.trim(),
            source: 'landing_page',
            timestamp: new Date().toISOString(),
          })
        })
        
        if (!response.ok) {
          throw new Error('Erro ao enviar solicitação')
        }
        
        showSuccess()
        
        // Analytics tracking
        if (typeof window !== 'undefined' && 'gtag' in window) {
          const gtag = (window as any).gtag
          gtag('event', 'trial_form_completed', {
            event_category: 'engagement',
            event_label: email
          })
        }
        
      } catch (error) {
        console.error('Trial signup failed:', error)
        showFormError('Erro ao enviar solicitação. Tente novamente em alguns minutos.')
      } finally {
        submitBtn.disabled = false
        submitText!.textContent = 'Começar Teste Gratuito'
        loadingSpinner?.classList.add('hidden')
      }
    })
    
    // ESC key listener
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        closeModal()
      }
    }
    
    document.addEventListener('keydown', handleEscape)
    
    return trialModal
  }
  
  const showTrialModal = () => {
    // Store the currently focused element
    previousFocusedElement = document.activeElement as HTMLElement
    
    if (!trialModal) {
      createTrialModal()
    }
    
    trialModal?.classList.remove('hidden')
    document.body.style.overflow = 'hidden'
    
    // Focus the first focusable element in the modal
    setTimeout(() => {
      const firstFocusable = trialModal?.querySelector('input, button, [tabindex]:not([tabindex="-1"])') as HTMLElement
      firstFocusable?.focus()
    }, 50)
    
    // Analytics tracking
    if (typeof window !== 'undefined' && 'gtag' in window) {
      const gtag = (window as any).gtag
      gtag('event', 'trial_modal_opened', {
        event_category: 'engagement'
      })
    }
  }
  
  // Add click listeners to all trial buttons
  document.addEventListener('DOMContentLoaded', () => {
    const trialButtons = document.querySelectorAll('[id*="trial-button"], [data-plan]')
    
    trialButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault()
        showTrialModal()
      })
    })
  })
</script>

